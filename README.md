# opticalflow_detector

В репозитории приведена информация о моих попытках использовать оптический поток для обнаружения.


## Что реализовано?

В исходном коде содержится 2 детектора:

1. CA-CFAR
2. CA-CFAR + OpticalFlow

Также в исходном коде содержится парсер бинарных файлов (методы _setup_file()_ + _get_data_by_id()_)

## Что такое оптический поток?

Оптический поток – это изображение видимого движения, представляющее собой сдвиг каждой точки между двумя изображениями. Т.е. оптический поток представляет собой матрицу скоростей. \
Оптический поток может быть рассчитан разными способами. Самым популярным является Lucas-Kanade, однако я использовал второй по популярности метод Farnback. Существуют и другие методы, но результативно применить их у меня не получилось.

## Как это реализовано?

Реализация оптического потока была взята из OpenCV, CA-CFAR был написан самостоятельно.\
Из-за большого шума на ФН, использовать просто оптический поток представляется мне невозможным, поэтому для начального выделения объектов служит CA-CFAR.

## Описание алгоритма
Далее этот алгоритм будем называть FlowDetector. Схема алгоритма:

mermaid
graph LR
A[ЦОС] -- ФН_2 --> B[CA-CFAR]
A -- ФН_2 --> C((*))
B -- Маска --> C
G[ЦОС] -- ФН_1 --> K[CA-CFAR]
G -- ФН_1 --> D((*))
K -- Маска --> D
D --> F[Optical Flow]
C --> F
F -- Оптический поток --> L[Abs]
L -- Матрица длин --> V[Если больше порога, то 1, else 0]

Т.к. ФН зашумлена, для первичного выделения используется CA-CFAR с повышенной вероятностью ложной тревоги. Таким образом обнаружения CFAR'а всегда содержат ложные цели. Далее для двух идущих подряд во времени ФН рассчитывается оптический поток. Далее рассчитывается ампплитуда оптического потока и при превышении некоторого порога фиксируется наличие цели. \
Алгоритм, который использует оптический поток основывается на том, что настоящие цели движутся по ФН плавно и логично, а ложные цели меняют положение случайным образом и для них оптический поток просто не вычисляется.


## Насколько хорошо работает?
Ну, в режиме работы, когда радар смотрит на небо, работает неплохо, ОСШ целей, которые различает детектор удалось значительно понизить. Однако в режиме работы, когда радар смотри на дорогу, целей слишком много, и оптический поток считается далеко не для всех целей. Разработанный алгоритм требует примерно в 1.15 раз больше времени, чем CA-CFAR. Это, пожалуй, не критично, но в купе с нестабильной работой в разных условиях эксплуатации радара, мне кажется, что использование оптического в том алгоритме, что предлагаю я бесперспективно.


## Что было бы круто реализовать
Круто было добиться того, чтобы алгоритм оптического потока корректно рассчитывал направление движения объекта и тогда можно бы было более точно и по назначению применять оптический поток и вообще давать очень много информации классификатору.
